
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cast Diagnostic</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 20px; background: #f5f5f5; color: #333; line-height: 1.5; }
    .card { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
    button { background: #2563eb; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer; }
    button:disabled { background: #ccc; }
    pre { background: #eee; padding: 10px; border-radius: 8px; font-size: 12px; overflow: auto; max-height: 200px; }
    .status { font-weight: bold; }
    .ok { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Диагностика Remote Playback</h2>
    <p>Браузер поддерживает API: <span id="apiSupport" class="status">Проверка...</span></p>
    <p>Устройства доступны: <span id="availability" class="status">Ожидание...</span></p>
    <button id="btnPrompt">Открыть выбор устройства</button>
  </div>

  <div class="card">
    <h3>Лог событий</h3>
    <pre id="log"></pre>
  </div>

  <video id="testVideo" src="https://www.w3schools.com/html/mov_bbb.mp4" style="display:none"></video>

  <script>
    const logEl = document.getElementById('log');
    const apiSupportEl = document.getElementById('apiSupport');
    const availabilityEl = document.getElementById('availability');
    const btnPrompt = document.getElementById('btnPrompt');
    const video = document.getElementById('testVideo');

    function log(msg) {
      logEl.textContent += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
      logEl.scrollTop = logEl.scrollHeight;
    }

    if (video.remote) {
      apiSupportEl.textContent = 'Да';
      apiSupportEl.className = 'status ok';
      log('Remote Playback API обнаружен');

      video.remote.watchAvailability((available) => {
        availabilityEl.textContent = available ? 'Да' : 'Нет';
        availabilityEl.className = available ? 'status ok' : 'status error';
        log('Доступность устройств: ' + available);
      }).catch(err => {
        availabilityEl.textContent = 'Не поддерживается watchAvailability';
        log('Ошибка watchAvailability: ' + err.message);
      });

      btnPrompt.onclick = () => {
        log('Нажата кнопка Prompt');
        video.remote.prompt().then(() => {
          log('Окно выбора успешно открыто');
        }).catch(err => {
          log('Ошибка prompt: ' + err.name + ' - ' + err.message);
        });
      };
    } else {
      apiSupportEl.textContent = 'Нет';
      apiSupportEl.className = 'status error';
      btnPrompt.disabled = true;
      log('Remote Playback API НЕ поддерживается в этом браузере');
    }
  </script>
</body>
</html>
